{"ts":1354219214887,"silentsave":true,"restoring":false,"patch":[[]],"length":0}
{"contributors":[],"silentsave":false,"ts":1354219215426,"patch":[[{"diffs":[[1,"var DEBUG = false;\r\nvar cache = {summary: null, details: null};\r\n\r\nvar controller = {\r\n    search: function() {\r\n\t\t$(\"#search form input\").eq(0).focus();\r\n\t}\r\n\t,summary: function(eventType, matchObj, ui, page, evt) {\r\n\t\tvar input = decodeURIComponent(matchObj[1].replace(/\\+/g, \"%20\")).replace(/^\\s+|\\s+$/g, \"\");\r\n\t\tif(cache.summary != matchObj[0]) {\r\n\t\t\t$(\"[data-role=\\\"content\\\"]\", page).empty();\r\n\t\t\tsetLoading(true);\r\n\t\t\tphillyapi.getAddressKey(input, function(addressKey, address) {\r\n\t\t\t\tif(addressKey) {\r\n\t\t\t\t\tphillyapi.getSummary(addressKey, function(data) {\r\n\t\t\t\t\t\tif(DEBUG) console.log(data);\r\n\t\t\t\t\t\tif(_.isEmpty(data)) {\r\n\t\t\t\t\t\t\tcontroller.error(\"No history found for this address\", page);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t$(\"[data-role=\\\"content\\\"]\", page).html(_.template($(\"#template-summary\").html(), {address: address, data: data}));\r\n\t\t\t\t\t\t\t$(\"[data-role=\\\"listview\\\"]\", page).listview();\r\n\t\t\t\t\t\t\tcache.summary = matchObj[0];\r\n\t\t\t\t\t\t\tsetLoading(false);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, function(xhr, status, error) {\r\n\t\t\t\t\t\tcontroller.error(\"There was an issue fetching the summary data from the server\", page, xhr);\r\n\t\t\t\t\t}, true);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcontroller.error(\"The address entered is not a valid L&I address\", page);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t,permit: function(eventType, matchObj, ui, page, evt) {\r\n\t\tif(cache.details != matchObj[0]) {\r\n\t\t\t$(\"[data-role=\\\"content\\\"]\", page).empty();\r\n\t\t\tsetLoading(true);\r\n\t\t\tphillyapi.getPermit(matchObj[1], function(data) {\r\n\t\t\t\tif(DEBUG) console.log(data);\r\n\t\t\t\t$(\"[data-role=\\\"content\\\"]\", page).html(_.template($(\"#template-details-permit\").html(), {data: data.d}));\r\n\t\t\t\tcache.details = matchObj[0];\r\n\t\t\t\tsetLoading(false);\r\n\t\t\t}, function(xhr, status, error) {\r\n\t\t\t\tcontroller.error(\"There was an issue fetching the permit data from the server\", page, xhr);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t,license: function(eventType, matchObj, ui, page, evt) {\r\n\t\tif(cache.details != matchObj[0]) {\r\n\t\t\t$(\"[data-role=\\\"content\\\"]\", page).empty();\r\n\t\t\tsetLoading(true);\r\n\t\t\tphillyapi.getLicense(matchObj[1], function(data) {\r\n\t\t\t\tif(DEBUG) console.log(data);\r\n\t\t\t\t$(\"[data-role=\\\"content\\\"]\", page).html(_.template($(\"#template-details-license\").html(), {data: data.d}));\r\n\t\t\t\tcache.details = matchObj[0];\r\n\t\t\t\tsetLoading(false);\r\n\t\t\t}, function(xhr, status, error) {\r\n\t\t\t\tcontroller.error(\"There was an issue fetching the license data from the server\", page, xhr);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t,_case: function(eventType, matchObj, ui, page, evt) {\r\n\t\tif(cache.details != matchObj[0]) {\r\n\t\t\t$(\"[data-role=\\\"content\\\"]\", page).empty();\r\n\t\t\tsetLoading(true);\r\n\t\t\tphillyapi.getCase(matchObj[1], function(data) {\r\n\t\t\t\tif(DEBUG) console.log(data);\r\n\t\t\t\t$(\"[data-role=\\\"content\\\"]\", page).html(_.template($(\"#template-details-case\").html(), {data: data.d}));\r\n\t\t\t\t$(\"[data-role=\\\"collapsible-set\\\"]\", page).collapsibleset();\r\n\t\t\t\tcache.details = matchObj[0];\r\n\t\t\t\tsetLoading(false);\r\n\t\t\t}, function(xhr, status, error) {\r\n\t\t\t\tcontroller.error(\"There was an issue fetching the case data from the server\", page, xhr);\r\n\t\t\t}, true);\r\n\t\t}\r\n\t}\r\n\t,appeal: function(eventType, matchObj, ui, page, evt) {\r\n\t\tif(cache.details != matchObj[0]) {\r\n\t\t\t$(\"[data-role=\\\"content\\\"]\", page).empty();\r\n\t\t\tsetLoading(true);\r\n\t\t\tphillyapi.getAppeal(matchObj[1] + \"appeals\", matchObj[2], function(data) {\r\n\t\t\t\tif(DEBUG) console.log(data);\r\n\t\t\t\t$(\"[data-role=\\\"content\\\"]\", page).html(_.template($(\"#template-details-appeal\").html(), {data: data.d}));\r\n\t\t\t\t$(\"[data-role=\\\"collapsible-set\\\"]\", page).collapsibleset();\r\n\t\t\t\tcache.details = matchObj[0];\r\n\t\t\t\tsetLoading(false);\r\n\t\t\t}, function(xhr, status, error) {\r\n\t\t\t\tcontroller.error(\"There was an issue fetching the appeal data from the server\", page, xhr);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t,error: function(errorMsg, page, xhr) {\r\n\t\t$(\"[data-role=\\\"content\\\"]\", page).html(_.template($(\"#template-details-error\").html(), {errorMsg: errorMsg, xhr: xhr}));\r\n\t\tsetLoading(false);\r\n\t}\r\n};\r\nnew $.mobile.Router({\r\n\t\"#search\": { handler: \"search\", events: \"s\" }\r\n\t,\"#summary\\\\?address=(.*)\": { handler: \"summary\", events: \"bs\" }\r\n\t,\"#details\\\\?entity=permits&eid=(\\\\d*)\": { handler: \"permit\", events: \"bs\" }\r\n\t,\"#details\\\\?entity=licenses&eid=(\\\\d*)\": { handler: \"license\", events: \"bs\" }\r\n\t,\"#details\\\\?entity=violationdetails&eid=(\\\\d*)\": { handler: \"_case\", events: \"bs\" }\r\n\t,\"#details\\\\?entity=(.*)appeals&eid=(\\\\d*)\": { handler: \"appeal\", events: \"bs\" }\r\n}, controller);\r\n\r\n$(document).ready(function() {\r\n    // Ensure user has input an address before pressing search\r\n\t$(\"#search form\").submit(function(e) {\r\n\t\tvar inputNode = $(\"input[name=\\\"address\\\"]\", $(this));\r\n\t\tif( ! $.trim(inputNode.val())) {\r\n\t\t\tinputNode.focus();\r\n\t\t\treturn false;\r\n\t\t}\r\n\t});\r\n});\r\n\r\n// Necessary because v1.1.0 of jQuery Mobile doesn't seem to let you show the loading message during pagebeforeshow\r\nfunction setLoading(on) {\r\n\tif(on) $(\"body\").addClass(\"ui-loading\");\r\n\telse $(\"body\").removeClass(\"ui-loading\");\r\n}\r\n\r\nfunction display_date(input, show_time){\r\n\tvar str;\r\n\tif(input) {\r\n\t\tvar UNIX_timestamp = input.replace(/\\D/g, \"\") / 1000;\r\n\t\tvar a = new Date(UNIX_timestamp*1000);\r\n\t\tvar months = [\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"];\r\n\t\tvar year = a.getFullYear();\r\n\t\tvar month = a.getMonth()+1;\r\n\t\tvar date = a.getDate();\r\n\t\tstr = month+\"/\"+date+\"/\"+year;\r\n\t\tif(show_time) {\r\n\t\t\tvar hour = a.getHours();\r\n\t\t\tvar min = (\"0\" + a.getMinutes()).slice(-2);\r\n\t\t\tvar sec = (\"0\" + a.getSeconds()).slice(-2);\r\n\t\t\tstr += hour+\":\"+min+\":\"+sec;\r\n\t\t}\r\n\t}\r\n\treturn str;\r\n}"]],"start1":0,"start2":0,"length1":0,"length2":5499}]],"length":5499,"saved":false}
